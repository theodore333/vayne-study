# Planned Features - Vayne Study

## Session Mode (–†–µ–∂–∏–º –°–µ—Å–∏—è) - Priority: HIGH

### Overview
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ–Ω –ø–ª–∞–Ω–∏—Ä–æ–≤—á–∏–∫ –∑–∞ –∏–∑–ø–∏—Ç–Ω–∞ —Å–µ—Å–∏—è. –°—ä–∑–¥–∞–≤–∞ –¥–µ—Ç–∞–π–ª–µ–Ω calendar/timetable –∫–æ–π—Ç–æ —Ä–∞–∑–ø—Ä–µ–¥–µ–ª—è –≤—Å–∏—á–∫–∏ —Ç–µ–º–∏ –ø–æ –¥–Ω–∏ –¥–æ –≤—Å–µ–∫–∏ –∏–∑–ø–∏—Ç. –°—Ç—É–¥–µ–Ω—Ç—ä—Ç –≤–∏–∂–¥–∞ —Ç–æ—á–Ω–æ –∫–∞–∫–≤–æ —Ç—Ä—è–±–≤–∞ –¥–∞ —É—á–∏ –≤—Å–µ–∫–∏ –¥–µ–Ω.

**–í–∞–∂–Ω–æ:** –ü–æ –≤—Ä–µ–º–µ –Ω–∞ —Å–µ—Å–∏—è –ù–Ø–ú–ê –ª–µ–∫—Ü–∏–∏ –∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è. –¶–µ–ª–∏—è—Ç –¥–µ–Ω –µ –∑–∞ —É—á–µ–Ω–µ.

---

### User Flow

1. **–ê–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ Session Mode**
   - –ë—É—Ç–æ–Ω "–ó–∞–ø–æ—á–Ω–∏ –°–µ—Å–∏—è" –≤ Today –∏–ª–∏ –Ω–æ–≤–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ /session
   - –ò–∑–±–∏—Ä–∞ –Ω–∞—á–∞–ª–Ω–∞ –∏ –∫—Ä–∞–π–Ω–∞ –¥–∞—Ç–∞ –Ω–∞ —Å–µ—Å–∏—è—Ç–∞ (–Ω–∞–ø—Ä. 15 –Æ–Ω–∏ - 10 –Æ–ª–∏)
   - –°–∏—Å—Ç–µ–º–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∑–∏–º–∞ –≤—Å–∏—á–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–∏ —Å examDate –≤ —Ç–æ–∑–∏ –ø–µ—Ä–∏–æ–¥

2. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–µ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–∞)**
   - –ß–∞—Å–æ–≤–µ –Ω–∞ –¥–µ–Ω: –∏–∑–ø–æ–ª–∑–≤–∞ studyGoals.dailyMinutes (–≤–µ—á–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞)
   - –£–∏–∫–µ–Ω–¥ —á–∞—Å–æ–≤–µ: –∏–∑–ø–æ–ª–∑–≤–∞ studyGoals.weekendDailyMinutes (–≤–µ—á–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞)
   - Buffer –¥–Ω–∏ –ø—Ä–µ–¥–∏ –∏–∑–ø–∏—Ç: 1-2 –¥–Ω–∏ –∑–∞ –ø—Ä–µ–≥–æ–≤–æ—Ä (default: 1)
   - –ú–∏–Ω—É—Ç–∏ –Ω–∞ —Ç–µ–º–∞ (average): default 30-45 –º–∏–Ω, –º–æ–∂–µ –¥–∞ —Å–µ –Ω–∞—Å—Ç—Ä–æ–∏

3. **–ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –ø–ª–∞–Ω**
   - –ê–ª–≥–æ—Ä–∏—Ç—ä–º—ä—Ç —Ä–∞–∑–ø—Ä–µ–¥–µ–ª—è —Ç–µ–º–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
   - –ü–æ–∫–∞–∑–≤–∞ calendar view —Å –≤—Å–µ–∫–∏ –¥–µ–Ω
   - Warning –∞–∫–æ –ø–ª–∞–Ω—ä—Ç –µ –Ω–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–µ–Ω

4. **Daily View**
   - –ü–æ–∫–∞–∑–≤–∞ —Ç–µ–º–∏—Ç–µ –∑–∞ –¥–Ω–µ—Å –∫–∞—Ç–æ checklist
   - –û—Ç–±–µ–ª—è–∑–≤–∞—à –∫–æ—è —Ç–µ–º–∞ —Å–∏ –º–∏–Ω–∞–ª
   - Progress bar –∑–∞ –¥–µ–Ω—è

5. **Rebalance**
   - –ê–∫–æ –∏–∑–æ—Å—Ç–∞–Ω–µ—à –∏–ª–∏ —Å–∏ –±–æ–ª–µ–Ω, –±—É—Ç–æ–Ω "–ü—Ä–µ–∏–∑—á–∏—Å–ª–∏"
   - –†–∞–∑–ø—Ä–µ–¥–µ–ª—è –æ—Å—Ç–∞–≤–∞—â–∏—Ç–µ —Ç–µ–º–∏ –ø–æ –æ—Å—Ç–∞–≤–∞—â–∏—Ç–µ –¥–Ω–∏

---

### Data Model

```typescript
// –ù–æ–≤ —Ç–∏–ø –≤ types.ts
interface SessionPlan {
  id: string;
  startDate: string;           // ISO date
  endDate: string;             // ISO date
  isActive: boolean;
  bufferDays: number;          // Days before exam for review (default 1)
  minutesPerTopic: number;     // Average minutes per topic (default 40)
  createdAt: string;
  updatedAt: string;
}

interface SessionDay {
  date: string;                // ISO date (YYYY-MM-DD)
  type: 'study' | 'review' | 'exam' | 'rest';
  subjectId: string | null;    // Which subject this day is for
  subjectName: string | null;
  plannedTopics: string[];     // Topic IDs planned for this day
  completedTopics: string[];   // Topic IDs actually completed
  examId: string | null;       // If type === 'exam', which subject
  notes: string | null;
}

// –í AppData –¥–æ–±–∞–≤–∏:
interface AppData {
  // ... existing fields
  sessionPlan: SessionPlan | null;
  sessionDays: SessionDay[];
}
```

---

### Algorithm: generateSessionPlan()

```typescript
function generateSessionPlan(
  subjects: Subject[],
  sessionStart: Date,
  sessionEnd: Date,
  bufferDays: number,
  minutesPerTopic: number,
  dailyMinutes: number,
  weekendMinutes: number
): SessionDay[] {

  // 1. –°—ä–±–µ—Ä–∏ –≤—Å–∏—á–∫–∏ –∏–∑–ø–∏—Ç–∏ –≤ –ø–µ—Ä–∏–æ–¥–∞, —Å–æ—Ä—Ç–∏—Ä–∞–Ω–∏ –ø–æ –¥–∞—Ç–∞
  const exams = subjects
    .filter(s => s.examDate && isWithinSession(s.examDate))
    .sort((a, b) => new Date(a.examDate).getTime() - new Date(b.examDate).getTime());

  // 2. –ó–∞ –≤—Å–µ–∫–∏ –∏–∑–ø–∏—Ç –∏–∑—á–∏—Å–ª–∏:
  //    - availableDays = –¥–Ω–∏ –æ—Ç —Å–µ–≥–∞ (–∏–ª–∏ —Å–ª–µ–¥ –ø—Ä–µ–¥–∏—à–µ–Ω –∏–∑–ø–∏—Ç) –¥–æ examDate - bufferDays
  //    - remainingTopics = topics.filter(t => t.status !== 'green')
  //    - topicsPerDay = Math.ceil(remainingTopics.length / availableDays)

  // 3. –†–∞–∑–ø—Ä–µ–¥–µ–ª–∏ —Ç–µ–º–∏—Ç–µ –ø–æ –¥–Ω–∏:
  //    - –ò–∑—á–∏—Å–ª–∏ –∫–æ–ª–∫–æ —Ç–µ–º–∏ —Å–µ —Å—ä–±–∏—Ä–∞—Ç –≤ –µ–¥–∏–Ω –¥–µ–Ω (dailyMinutes / minutesPerTopic)
  //    - –ê–∫–æ topicsPerDay > maxTopicsPerDay, –º–∞—Ä–∫–∏—Ä–∞–π –∫–∞—Ç–æ WARNING
  //    - –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–∞–π: gray > orange > yellow (–Ω–µ–ø–æ–∫—Ä–∏—Ç–∏—Ç–µ –ø—ä—Ä–≤–æ)

  // 4. –î–æ–±–∞–≤–∏ buffer –¥–Ω–∏ –ø—Ä–µ–¥–∏ –≤—Å–µ–∫–∏ –∏–∑–ø–∏—Ç (type: 'review')

  // 5. –ú–∞—Ä–∫–∏—Ä–∞–π exam days (type: 'exam')

  // 6. Return –º–∞—Å–∏–≤ –æ—Ç SessionDay –æ–±–µ–∫—Ç–∏

  // –°–ü–ï–¶–ò–ê–õ–ù–ê –õ–û–ì–ò–ö–ê:
  // - –ê–∫–æ –∏–º–∞ 2+ –∏–∑–ø–∏—Ç–∞ –±–ª–∏–∑–æ –µ–¥–∏–Ω –¥–æ –¥—Ä—É–≥, —Ä–µ–¥—É–≤–∞–π –ø—Ä–µ–¥–º–µ—Ç–∏—Ç–µ
  // - –ê–∫–æ examFormat –≤–∫–ª—é—á–≤–∞ "—Å–ª—É—á–∞–µ–Ω" - –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–∞–π —à–∏—Ä–æ–∫–æ –ø–æ–∫—Ä–∏—Ç–∏–µ
  // - –ê–∫–æ —Ç–µ–º–∞ –µ "weak" (–Ω–∏—Å—ä–∫ quiz score) - —Å–ª–æ–∂–∏ —è –ø–æ-—Ä–∞–Ω–æ –∑–∞ –ø–æ–≤–µ—á–µ –≤—Ä–µ–º–µ

}
```

---

### UI Components

#### 1. Session Setup Page (/session –∏–ª–∏ modal)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ó–ê–ü–û–ß–ù–ò –°–ï–°–ò–Ø                                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –ü–µ—Ä–∏–æ–¥: [15 –Æ–Ω–∏ 2025] - [10 –Æ–ª–∏ 2025]             ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  –û—Ç–∫—Ä–∏—Ç–∏ –∏–∑–ø–∏—Ç–∏:                                    ‚îÇ
‚îÇ  ‚úì –ì–µ–Ω–µ—Ç–∏–∫–∞ - 18 –Æ–Ω–∏ (65 —Ç–µ–º–∏, 55 –æ—Å—Ç–∞–≤–∞—â–∏)        ‚îÇ
‚îÇ  ‚úì –ê–Ω–∞—Ç–æ–º–∏—è - 25 –Æ–Ω–∏ (120 —Ç–µ–º–∏, 80 –æ—Å—Ç–∞–≤–∞—â–∏)       ‚îÇ
‚îÇ  ‚úì –ë–∏–æ—Ö–∏–º–∏—è - 5 –Æ–ª–∏ (90 —Ç–µ–º–∏, 90 –æ—Å—Ç–∞–≤–∞—â–∏)         ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  –ù–∞—Å—Ç—Ä–æ–π–∫–∏:                                         ‚îÇ
‚îÇ  - Buffer –¥–Ω–∏ –ø—Ä–µ–¥–∏ –∏–∑–ø–∏—Ç: [1] –¥–µ–Ω                  ‚îÇ
‚îÇ  - –ú–∏–Ω—É—Ç–∏ –Ω–∞ —Ç–µ–º–∞ (—Å—Ä–µ–¥–Ω–æ): [40] –º–∏–Ω                ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  [ –ì–µ–Ω–µ—Ä–∏—Ä–∞–π –ü–ª–∞–Ω ]                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### 2. Session Calendar View (/session/calendar)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –°–ï–°–ò–Ø: 15 –Æ–Ω–∏ - 10 –Æ–ª–∏          [–ü—Ä–µ–∏–∑—á–∏—Å–ª–∏ –ø–ª–∞–Ω] ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                     ‚îÇ
‚îÇ  –Æ–ù–ò 2025                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ  ‚îÇ –ü–æ–Ω ‚îÇ –í—Ç–æ ‚îÇ –°—Ä—è ‚îÇ –ß–µ—Ç ‚îÇ –ü–µ—Ç ‚îÇ –°—ä–± ‚îÇ –ù–µ–¥ ‚îÇ       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§       ‚îÇ
‚îÇ  ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ 15  ‚îÇ 16  ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ GEN ‚îÇ GEN ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ 8t  ‚îÇ 8t  ‚îÇ       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§       ‚îÇ
‚îÇ  ‚îÇ 17  ‚îÇ 18  ‚îÇ 19  ‚îÇ 20  ‚îÇ 21  ‚îÇ 22  ‚îÇ 23  ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ REV ‚îÇ EXAM‚îÇ ANA ‚îÇ ANA ‚îÇ ANA ‚îÇ ANA ‚îÇ ANA ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ GEN ‚îÇ GEN ‚îÇ 10t ‚îÇ 10t ‚îÇ 10t ‚îÇ 6t  ‚îÇ 6t  ‚îÇ       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§       ‚îÇ
‚îÇ  ‚îÇ ... ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ       ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  –õ–µ–≥–µ–Ω–¥–∞: GEN=–ì–µ–Ω–µ—Ç–∏–∫–∞, ANA=–ê–Ω–∞—Ç–æ–º–∏—è               ‚îÇ
‚îÇ           REV=–ü—Ä–µ–≥–æ–≤–æ—Ä, EXAM=–ò–∑–ø–∏—Ç, t=—Ç–µ–º–∏          ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ‚ö†Ô∏è WARNING: –ê–Ω–∞—Ç–æ–º–∏—è –∏–∑–∏—Å–∫–≤–∞ 10 —Ç–µ–º–∏/–¥–µ–Ω          ‚îÇ
‚îÇ     (–ø—Ä–µ–ø–æ—Ä—ä—á–∏—Ç–µ–ª–Ω–æ: max 8)                         ‚îÇ
‚îÇ                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### 3. Daily Session View (–≤ Today page –∏–ª–∏ –æ—Ç–¥–µ–ª–Ω–∞)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –î–ù–ï–°: –ü–æ–Ω–µ–¥–µ–ª–Ω–∏–∫, 17 –Æ–Ω–∏                          ‚îÇ
‚îÇ  –ü—Ä–µ–¥–º–µ—Ç: –ì–ï–ù–ï–¢–ò–ö–ê (–ø—Ä–µ–≥–æ–≤–æ—Ä –ø—Ä–µ–¥–∏ –∏–∑–ø–∏—Ç)          ‚îÇ
‚îÇ  –ò–∑–ø–∏—Ç: –£–¢–†–ï!                                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                     ‚îÇ
‚îÇ  –¢–µ–º–∏ –∑–∞ –ø—Ä–µ–≥–æ–≤–æ—Ä (10):                            ‚îÇ
‚îÇ  ‚úì –ú–µ–Ω–¥–µ–ª–æ–≤–∏ –∑–∞–∫–æ–Ω–∏                                ‚îÇ
‚îÇ  ‚úì –•—Ä–æ–º–æ–∑–æ–º–Ω–∞ —Ç–µ–æ—Ä–∏—è                               ‚îÇ
‚îÇ  ‚òê –ì–µ–Ω–Ω–∏ –º—É—Ç–∞—Ü–∏–∏                                   ‚îÇ
‚îÇ  ‚òê –•—Ä–æ–º–æ–∑–æ–º–Ω–∏ –∞–±–µ—Ä–∞—Ü–∏–∏                             ‚îÇ
‚îÇ  ‚òê –ü–æ–ª–æ–≤–æ —Å–≤—ä—Ä–∑–∞–Ω–æ —É–Ω–∞—Å–ª–µ–¥—è–≤–∞–Ω–µ                    ‚îÇ
‚îÇ  ‚òê –ú–∏—Ç–æ—Ö–æ–Ω–¥—Ä–∏–∞–ª–Ω–æ —É–Ω–∞—Å–ª–µ–¥—è–≤–∞–Ω–µ                     ‚îÇ
‚îÇ  ‚òê –ï–ø–∏–≥–µ–Ω–µ—Ç–∏–∫–∞                                     ‚îÇ
‚îÇ  ‚òê –ì–µ–Ω–µ—Ç–∏—á–Ω–∏ –±–æ–ª–µ—Å—Ç–∏                               ‚îÇ
‚îÇ  ‚òê –ü–æ–ø—É–ª–∞—Ü–∏–æ–Ω–Ω–∞ –≥–µ–Ω–µ—Ç–∏–∫–∞                           ‚îÇ
‚îÇ  ‚òê –ì–µ–Ω–µ—Ç–∏—á–Ω–æ –∫–æ–Ω—Å—É–ª—Ç–∏—Ä–∞–Ω–µ                          ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  –ü—Ä–æ–≥—Ä–µ—Å: ‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 2/10 (20%)                    ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  [ –ó–∞–ø–æ—á–Ω–∏ —Ç–∞–π–º–µ—Ä –∑–∞ —Ç–µ–∫—É—â–∞ —Ç–µ–º–∞ ]                 ‚îÇ
‚îÇ                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### 4. Session Stats Panel
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ù–ê –°–ï–°–ò–Ø–¢–ê                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –û–±—â–æ –¥–Ω–∏: 25                                       ‚îÇ
‚îÇ  –ò–∑–º–∏–Ω–∞–ª–∏: 3                                        ‚îÇ
‚îÇ  –û—Å—Ç–∞–≤–∞—â–∏: 22                                       ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  –ò–∑–ø–∏—Ç–∏:                                            ‚îÇ
‚îÇ  ‚úì –ì–µ–Ω–µ—Ç–∏–∫–∞ (18 –Æ–Ω–∏) - 55/55 —Ç–µ–º–∏ –º–∏–Ω–∞—Ç–∏           ‚îÇ
‚îÇ  ‚Üí –ê–Ω–∞—Ç–æ–º–∏—è (25 –Æ–Ω–∏) - 30/80 —Ç–µ–º–∏ (37%)            ‚îÇ
‚îÇ  ‚óã –ë–∏–æ—Ö–∏–º–∏—è (5 –Æ–ª–∏) - 0/90 —Ç–µ–º–∏                    ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  On track: –î–ê / –ù–ï                                  ‚îÇ
‚îÇ  –ê–∫–æ –ø—Ä–æ–¥—ä–ª–∂–∏—à —Ç–∞–∫–∞: –©–µ —Å–≤—ä—Ä—à–∏—à –Ω–∞ 3 –Æ–ª–∏           ‚îÇ
‚îÇ                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### Integration Points

1. **Today Page**
   - –ê–∫–æ sessionPlan.isActive === true, –ø–æ–∫–∞–∑–≤–∞ Session Daily View –≤–º–µ—Å—Ç–æ/–¥–æ Daily Plan
   - –ò–ª–∏ –¥–æ–±–∞–≤—è —Å–µ–∫—Ü–∏—è "–°–µ—Å–∏—è" —Å —Ç–µ–º–∏—Ç–µ –∑–∞ –¥–Ω–µ—Å

2. **Timer**
   - –ö–æ–≥–∞—Ç–æ –∏–∑–±–µ—Ä–µ—à —Ç–µ–º–∞ –æ—Ç Session Daily View, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–∞—Ä—Ç–∏—Ä–∞ —Ç–∞–π–º–µ—Ä
   - –°–ª–µ–¥ –ø—Ä–∏–∫–ª—é—á–≤–∞–Ω–µ, –º–∞—Ä–∫–∏—Ä–∞ —Ç–µ–º–∞—Ç–∞ –∫–∞—Ç–æ completed –≤ sessionDays

3. **AI Advice**
   - –ê–∫–æ –µ –∞–∫—Ç–∏–≤–Ω–∞ —Å–µ—Å–∏—è, AI –ø–æ–ª—É—á–∞–≤–∞ sessionPlan –∏ sessionDays
   - –ú–æ–∂–µ –¥–∞ –∫–æ–º–µ–Ω—Ç–∏—Ä–∞: "–ò–∑–æ—Å—Ç–∞–≤–∞—à —Å 5 —Ç–µ–º–∏ –æ—Ç –ø–ª–∞–Ω–∞, –Ω–∞–≤–∞–∫—Å–∞–π –¥–Ω–µ—Å"

4. **Topic Status**
   - –ö–æ–≥–∞—Ç–æ –º–∞—Ä–∫–∏—Ä–∞—à —Ç–µ–º–∞ –∫–∞—Ç–æ completed –≤ —Å–µ—Å–∏—è—Ç–∞, update-–≤–∞ topic.status
   - gray ‚Üí orange (–º–∏–Ω–∞—Ç–æ), orange ‚Üí yellow (–ø—Ä–µ–≥–æ–≤–æ—Ä–µ–Ω–æ)

5. **Floating Widget**
   - –ü–æ–∫–∞–∑–≤–∞: "–°–µ—Å–∏—è: 3/10 —Ç–µ–º–∏ –¥–Ω–µ—Å | –ì–µ–Ω–µ—Ç–∏–∫–∞ | –ò–∑–ø–∏—Ç —Å–ª–µ–¥ 2–¥"

---

### Edge Cases & Special Logic

1. **–ù–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–µ–Ω –ø–ª–∞–Ω**
   - –ê–∫–æ topicsPerDay > 15, –ø–æ–∫–∞–∑–≤–∞ WARNING
   - –ê–∫–æ topicsPerDay > 25, –ø–æ–∫–∞–∑–≤–∞ CRITICAL –∏ –ø—Ä–µ–¥–ª–∞–≥–∞ –¥–∞ —Å–µ –Ω–∞–º–∞–ª–∏ –æ–±—Ö–≤–∞—Ç–∞

2. **–ò–∑–æ—Å—Ç–∞–≤–∞–Ω–µ –æ—Ç –ø–ª–∞–Ω–∞**
   - Track-–≤–∞ completedTopics vs plannedTopics –∑–∞ –≤—Å–µ–∫–∏ –¥–µ–Ω
   - –ê–∫–æ –∑–∞–≤—ä—Ä—à–∏—à –¥–µ–Ω—è —Å deficit, –ø–æ–∫–∞–∑–≤–∞ –æ–ø—Ü–∏—è "–ü—Ä–µ–∏–∑—á–∏—Å–ª–∏ –ø–ª–∞–Ω"
   - Rebalance —Ä–∞–∑–ø—Ä–µ–¥–µ–ª—è –ø—Ä–æ–ø—É—Å–Ω–∞—Ç–∏—Ç–µ —Ç–µ–º–∏ –≤ –æ—Å—Ç–∞–≤–∞—â–∏—Ç–µ –¥–Ω–∏

3. **–ë–æ–ª–µ–Ω –¥–µ–Ω**
   - –ê–∫–æ dailyStatus.sick === true, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞–º–∞–ª—è–≤–∞ plannedTopics –∑–∞ –¥–µ–Ω—è —Å 50%
   - –û—Å—Ç–∞—Ç—ä–∫—ä—Ç —Å–µ —Ä–∞–∑–ø—Ä–µ–¥–µ–ª—è –≤ —Å–ª–µ–¥–≤–∞—â–∏—Ç–µ –¥–Ω–∏

4. **–î–≤–∞ –∏–∑–ø–∏—Ç–∞ –≤ –µ–¥–∏–Ω –¥–µ–Ω**
   - –†—è–¥–∫–æ, –Ω–æ –≤—ä–∑–º–æ–∂–Ω–æ
   - –ê–ª–≥–æ—Ä–∏—Ç—ä–º—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ —Ä–∞–∑–¥–µ–ª–∏ –ø—Ä–µ–¥–∏—à–Ω–∏—Ç–µ –¥–Ω–∏ –º–µ–∂–¥—É –¥–≤–∞—Ç–∞ –ø—Ä–µ–¥–º–µ—Ç–∞

5. **–ò–∑–ø–∏—Ç –±–µ–∑ —Ç–µ–º–∏**
   - –ê–∫–æ –ø—Ä–µ–¥–º–µ—Ç –Ω—è–º–∞ topics, –ø—Ä–æ–ø—É—Å–Ω–∏ –≥–æ –æ—Ç –ø–ª–∞–Ω–∞
   - –ü–æ–∫–∞–∂–∏ warning: "–ê–Ω–∞—Ç–æ–º–∏—è –∏–º–∞ –∏–∑–ø–∏—Ç –Ω–æ –Ω—è–º–∞ —Ç–µ–º–∏!"

6. **Exam Format Integration**
   - –ê–∫–æ examFormat –≤–∫–ª—é—á–≤–∞ "—Å–ª—É—á–∞–µ–Ω –∏–∑–±–æ—Ä" / "—Ç–µ–≥–ª—è—Ç —Å–µ":
     - –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–∞–π —à–∏—Ä–æ–∫–æ –ø–æ–∫—Ä–∏—Ç–∏–µ (–ø–æ–≤–µ—á–µ —Ç–µ–º–∏, –ø–æ-–º–∞–ª–∫–æ –¥—ä–ª–±–æ—á–∏–Ω–∞)
     - –í review –¥–Ω–∏—Ç–µ, —Ñ–æ–∫—É—Å–∏—Ä–∞–π —Å–µ –Ω–∞ overview –≤–º–µ—Å—Ç–æ –¥–µ—Ç–∞–π–ª–∏
   - –ê–∫–æ examFormat –≤–∫–ª—é—á–≤–∞ "–∫–∞–∑—É—Å–∏":
     - –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–∞–π –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Ç–µ–º–∏
     - –ü—Ä–µ–ø–æ—Ä—ä—á–∞–π –ø–æ–≤–µ—á–µ –≤—Ä–µ–º–µ –Ω–∞ —Ç–µ–º–∞ –∑–∞ —Ä–∞–∑–±–∏—Ä–∞–Ω–µ

---

### Implementation Steps (for Claude)

**Phase 1: Data Model & Storage**
1. –î–æ–±–∞–≤–∏ SessionPlan –∏ SessionDay –≤ types.ts
2. –î–æ–±–∞–≤–∏ sessionPlan –∏ sessionDays –≤ AppData (context.tsx, storage.ts)
3. –î–æ–±–∞–≤–∏ CRUD —Ñ—É–Ω–∫—Ü–∏–∏: createSessionPlan, updateSessionDay, clearSession

**Phase 2: Algorithm**
1. –°—ä–∑–¥–∞–π lib/session-planner.ts
2. –ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–π generateSessionPlan()
3. –ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–π rebalanceSession()
4. –î–æ–±–∞–≤–∏ helper —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞ –∏–∑—á–∏—Å–ª–µ–Ω–∏—è

**Phase 3: UI - Setup**
1. –°—ä–∑–¥–∞–π app/session/page.tsx
2. Session setup form —Å –¥–∞—Ç–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
3. Preview –Ω–∞ –ø–ª–∞–Ω–∞ –ø—Ä–µ–¥–∏ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ

**Phase 4: UI - Calendar**
1. Calendar grid component
2. Day cell component —Å —Ü–≤–µ—Ç–æ–≤–µ –ø–æ –ø—Ä–µ–¥–º–µ—Ç
3. Legend –∏ warnings

**Phase 5: UI - Daily View**
1. Checklist –Ω–∞ —Ç–µ–º–∏ –∑–∞ –¥–µ–Ω—è
2. Progress bar
3. Quick actions (—Å—Ç–∞—Ä—Ç —Ç–∞–π–º–µ—Ä, –º–∞—Ä–∫–∏—Ä–∞–π –≥–æ—Ç–æ–≤–æ)

**Phase 6: Integration**
1. Today page - –ø–æ–∫–∞–∑–≤–∞ session info –∞–∫–æ –µ –∞–∫—Ç–∏–≤–Ω–∞
2. Timer - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∏–∑–±–∏—Ä–∞ —Ç–µ–º–∞ –æ—Ç –ø–ª–∞–Ω–∞
3. AI Advice - –ø–æ–ª—É—á–∞–≤–∞ session context
4. Floating widget - session progress

**Phase 7: Polish**
1. Rebalance —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç
2. Sick day handling
3. Warnings –∏ notifications
4. Export to calendar (optional, low priority)

---

### Future Enhancements (v2)

- **Drag & drop** –∑–∞ —Ä—ä—á–Ω–æ –ø—Ä–µ–º–µ—Å—Ç–≤–∞–Ω–µ –Ω–∞ —Ç–µ–º–∏ –º–µ–∂–¥—É –¥–Ω–∏
- **Google Calendar export** - sync —Å –≤—ä–Ω—à–µ–Ω –∫–∞–ª–µ–Ω–¥–∞—Ä
- **Spaced repetition** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ schedule-–≤–∞ review –Ω–∞ –º–∏–Ω–∞—Ç–∏ —Ç–µ–º–∏
- **Difficulty rating** - –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –º–æ–∂–µ –¥–∞ –º–∞—Ä–∫–∏—Ä–∞ —Ç–µ–º–∞ –∫–∞—Ç–æ "—Ç—Ä—É–¥–Ω–∞" –∑–∞ –ø–æ–≤–µ—á–µ –≤—Ä–µ–º–µ
- **Study blocks** - —Å—É—Ç—Ä–∏–Ω –ü—Ä–µ–¥–º–µ—Ç A, —Å–ª–µ–¥–æ–±–µ–¥ –ü—Ä–µ–¥–º–µ—Ç B
- **Pomodoro integration** - –ø–ª–∞–Ω–∏—Ä–∞ –±—Ä–æ–π pomodoros –Ω–∞ —Ç–µ–º–∞
- **Analytics** - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω vs —Ä–µ–∞–ª–Ω–æ—Å—Ç, graphs

---

### Notes

- Session Mode –µ OPTIONAL - —Å—Ç—É–¥–µ–Ω—Ç—ä—Ç –º–æ–∂–µ –¥–∞ –Ω–µ –≥–æ –ø–æ–ª–∑–≤–∞
- –ù–µ –∑–∞–º–µ—Å—Ç–≤–∞ Daily Plan, –∞ –≥–æ –¥–æ–ø—ä–ª–≤–∞/–∑–∞–º–µ—Å—Ç–≤–∞ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ —Å–µ—Å–∏—è
- –§–æ–∫—É—Å –µ –Ω–∞ –ü–†–û–°–¢–û–¢–ê - –≥–µ–Ω–µ—Ä–∏—Ä–∞–π –ø–ª–∞–Ω, —Å–ª–µ–¥–≤–∞–π –≥–æ, –ø—Ä–µ–∏–∑—á–∏—Å–ª–∏ –∞–∫–æ —Ç—Ä—è–±–≤–∞
- Mobile-friendly –µ –≤–∞–∂–Ω–æ - —Å—Ç—É–¥–µ–Ω—Ç–∏—Ç–µ —É—á–∞—Ç –æ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å—ä–∑–¥–∞–¥–µ–Ω: –Ø–Ω—É–∞—Ä–∏ 2025*
*–ó–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è: –ü—Ä–µ–¥–∏ –ª—è—Ç–Ω–∞ —Å–µ—Å–∏—è 2025*

---
---

## Smart Scheduling & Prioritization - Priority: HIGH

### Overview

–ò–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∑–∞ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ —Ç–µ–º–∏, –±–∞–∑–∏—Ä–∞–Ω–∞ –Ω–∞:
1. **Topic Size** - –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ —Ç–µ–º–∏ –ø–æ –¥—ä–ª–∂–∏–Ω–∞ (small/medium/long)
2. **Topic Relations** - –≥—Ä—É–ø–∏—Ä–∞–Ω–µ –Ω–∞ —Å–≤—ä—Ä–∑–∞–Ω–∏ —Ç–µ–º–∏ –∑–∞ –ø–æ-–µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É—á–µ–Ω–µ
3. **Crunch Mode** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ–Ω —Ä–µ–∂–∏–º –ø—Ä–∏ time pressure, –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–∞—â –∫—Ä–∞—Ç–∫–∏ —Ç–µ–º–∏

**–ö–ª—é—á–æ–≤–∞ –∏–¥–µ—è:** –ü—Ä–∏ –∏–∑–ø–∏—Ç–∏ —Å—ä—Å —Å–ª—É—á–∞–µ–Ω –∏–∑–±–æ—Ä –Ω–∞ —Ç–µ–º–∏, –ø–æ-–¥–æ–±—Ä–µ –µ –¥–∞ –∑–Ω–∞–µ—à 10 –∫—Ä–∞—Ç–∫–∏ —Ç–µ–º–∏ –æ—Ç–∫–æ–ª–∫–æ—Ç–æ 3 –¥—ä–ª–≥–∏.

---

### Feature 1: Topic Size Classification

#### –ö–æ–≥–∞—Ç–æ —Å–µ –∑–∞–¥–∞–≤–∞?
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ** –ø—Ä–∏ import/extract –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª - AI –∞–Ω–∞–ª–∏–∑–∏—Ä–∞ –∏ –∫–ª–∞—Å–∏—Ñ–∏—Ü–∏—Ä–∞
- **–†—ä—á–Ω–æ** - –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –º–æ–∂–µ –¥–∞ –ø—Ä–æ–º–µ–Ω–∏ –∞–∫–æ –Ω–µ –µ —Å—ä–≥–ª–∞—Å–µ–Ω —Å AI

#### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
```
small:  –ö—Ä–∞—Ç–∫–∞ —Ç–µ–º–∞, 15-25 –º–∏–Ω –∑–∞ –Ω–∞—É—á–∞–≤–∞–Ω–µ
medium: –°—Ä–µ–¥–Ω–∞ —Ç–µ–º–∞, 30-45 –º–∏–Ω –∑–∞ –Ω–∞—É—á–∞–≤–∞–Ω–µ
large:  –î—ä–ª–≥–∞/—Å–ª–æ–∂–Ω–∞ —Ç–µ–º–∞, 60+ –º–∏–Ω –∑–∞ –Ω–∞—É—á–∞–≤–∞–Ω–µ
```

#### AI Classification Prompt (–ø—Ä–∏ extract-material)
```
–ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª–∏ —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞ —Ç–µ–º–∞—Ç–∞:
- small: –ú–∞–ª–∫–æ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ, 1-2 –æ—Å–Ω–æ–≤–Ω–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏, –ª–µ—Å–Ω–æ –∑–∞ –∑–∞–ø–æ–º–Ω—è–Ω–µ
- medium: –£–º–µ—Ä–µ–Ω–æ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ, 3-5 –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏, –Ω—É–∂–µ–Ω –µ –ø—Ä–µ–≥–æ–≤–æ—Ä
- large: –ú–Ω–æ–≥–æ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ, 6+ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏, —Å–ª–æ–∂–Ω–∏ –≤–∑–∞–∏–º–æ–≤—Ä—ä–∑–∫–∏

–í—ä—Ä–Ω–∏ JSON: { "size": "small" | "medium" | "large" }
```

#### Data Model
```typescript
// –í Topic type –¥–æ–±–∞–≤–∏:
interface Topic {
  // ... existing fields
  size: 'small' | 'medium' | 'large' | null;  // null = –Ω–µ –µ –∫–ª–∞—Å–∏—Ñ–∏—Ü–∏—Ä–∞–Ω–æ
  sizeSetBy: 'ai' | 'user' | null;            // –∫–æ–π –µ –∑–∞–¥–∞–ª —Ä–∞–∑–º–µ—Ä–∞
}
```

#### UI
- –í Topic Detail: –ø–æ–∫–∞–∑–≤–∞ badge "S" / "M" / "L" –¥–æ –∏–º–µ—Ç–æ
- Dropdown –∑–∞ —Ä—ä—á–Ω–∞ –ø—Ä–æ–º—è–Ω–∞
- –ü—Ä–∏ extract: –ø–æ–∫–∞–∑–≤–∞ AI suggestion —Å –æ–ø—Ü–∏—è –∑–∞ override

---

### Feature 2: Topic Relations (Clustering)

#### –ö–æ–≥–∞—Ç–æ —Å–µ –∑–∞–¥–∞–≤–∞?
1. **–ü—Ä–∏ import** - AI –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ç–∞–≥–≤–∞ related topics –æ—Ç —Å—ä—â–∏—è –ø—Ä–µ–¥–º–µ—Ç
2. **Batch Analysis** - –±—É—Ç–æ–Ω "–ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π –≤—Ä—ä–∑–∫–∏" –∑–∞ —Ü—è–ª –ø—Ä–µ–¥–º–µ—Ç/–∫–æ–Ω—Å–ø–µ–∫—Ç

#### –ö–∞–∫–≤–æ –ø—Ä–∞–≤–∏?
- –ì—Ä—É–ø–∏—Ä–∞ —Ç–µ–º–∏ —Å—ä—Å —Å–ø–æ–¥–µ–ª–µ–Ω –º–∞—Ç–µ—Ä–∏–∞–ª (–Ω–∞–ø—Ä. –≤—Å–∏—á–∫–∏ —Ç–µ–º–∏ –∑–∞ –±–µ–ª–∏ –¥—Ä–æ–±–æ–≤–µ ‚Üí "–ü—É–ª–º–æ–ª–æ–≥–∏—è")
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–∞ prerequisite –≤—Ä—ä–∑–∫–∏ (–¢–µ–º–∞ B –∏–∑–∏—Å–∫–≤–∞ –∑–Ω–∞–Ω–∏–µ –æ—Ç –¢–µ–º–∞ A)
- Scheduler —Å–ª–∞–≥–∞ —Å–≤—ä—Ä–∑–∞–Ω–∏ —Ç–µ–º–∏ –≤ –µ–¥–∏–Ω –¥–µ–Ω –∑–∞ –ø–æ-–±—ä—Ä–∑–æ —É—á–µ–Ω–µ

#### Data Model
```typescript
// –í Topic type –¥–æ–±–∞–≤–∏:
interface Topic {
  // ... existing fields
  relatedTopics: string[];     // Topic IDs –Ω–∞ —Å–≤—ä—Ä–∑–∞–Ω–∏ —Ç–µ–º–∏
  cluster: string | null;      // –ò–º–µ –Ω–∞ –≥—Ä—É–ø–∞—Ç–∞ (–Ω–∞–ø—Ä. "–ü—É–ª–º–æ–ª–æ–≥–∏—è")
  prerequisites: string[];     // Topic IDs –∫–æ–∏—Ç–æ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–µ –Ω–∞—É—á–∞—Ç –ø—ä—Ä–≤–æ
}

// –ò–ª–∏ –æ—Ç–¥–µ–ª–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞ –ø–æ-—Å–ª–æ–∂–Ω–∏ –≤—Ä—ä–∑–∫–∏:
interface TopicRelation {
  topicId: string;
  relatedTopicId: string;
  relationType: 'similar' | 'prerequisite' | 'same-cluster';
  strength: number;            // 0-1, –∫–æ–ª–∫–æ —Å–∏–ª–Ω–∞ –µ –≤—Ä—ä–∑–∫–∞—Ç–∞
}
```

#### AI Analysis Prompt (batch)
```
–ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π —Å–ª–µ–¥–Ω–∏—Ç–µ —Ç–µ–º–∏ –æ—Ç –ø—Ä–µ–¥–º–µ—Ç "${subjectName}":
${topicNames.join('\n')}

–ó–∞ –≤—Å—è–∫–∞ —Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª–∏:
1. cluster: –ì—Ä—É–ø–∞/–∫–∞—Ç–µ–≥–æ—Ä–∏—è (–Ω–∞–ø—Ä. "–ü—É–ª–º–æ–ª–æ–≥–∏—è", "–ö–∞—Ä–¥–∏–æ–ª–æ–≥–∏—è")
2. relatedTopics: –ö–æ–∏ –¥—Ä—É–≥–∏ —Ç–µ–º–∏ —Å–∞ —Å–≤—ä—Ä–∑–∞–Ω–∏ (—Å–ø–æ–¥–µ–ª—è—Ç –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏)
3. prerequisites: –ö–æ–∏ —Ç–µ–º–∏ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–µ –Ω–∞—É—á–∞—Ç –ü–†–ï–î–ò —Ç–∞–∑–∏

–í—ä—Ä–Ω–∏ JSON –º–∞—Å–∏–≤ —Å —Ä–µ–∑—É–ª—Ç–∞—Ç–∏.
```

#### UI
- –í Subjects page: –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ clusters (grouped view)
- Topic Detail: —Å–µ–∫—Ü–∏—è "–°–≤—ä—Ä–∑–∞–Ω–∏ —Ç–µ–º–∏" —Å –ª–∏–Ω–∫–æ–≤–µ
- –ü—Ä–∏ Batch Analysis: progress indicator + preview –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏

#### Scheduler Integration
```
–ü—Ä–∏ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –¥–Ω–µ–≤–µ–Ω –ø–ª–∞–Ω:

1. –í–∑–µ–º–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∏—Ç–µ —Ç–µ–º–∏ –∑–∞ –¥–µ–Ω—è
2. –ì—Ä—É–ø–∏—Ä–∞–π –≥–∏ –ø–æ cluster
3. –ê–∫–æ –¥–≤–µ —Ç–µ–º–∏ —Å–∞ related –ò —Å–µ —Å—ä–±–∏—Ä–∞—Ç –≤ –µ–¥–∏–Ω –¥–µ–Ω:
   ‚Üí –°–ª–æ–∂–∏ –≥–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–Ω–æ
   ‚Üí –ü–æ–∫–∞–∑–≤–∞: "–¢–µ–º–∞ X + –¢–µ–º–∞ Y (—Å–≤—ä—Ä–∑–∞–Ω–∏, —É—á–∏ –∑–∞–µ–¥–Ω–æ)"

–ü—Ä–∏–º–µ—Ä:
  –î–µ–Ω 1: –ì–µ–Ω–Ω–∏ –º—É—Ç–∞—Ü–∏–∏ ‚Üí –•—Ä–æ–º–æ–∑–æ–º–Ω–∏ –∞–±–µ—Ä–∞—Ü–∏–∏ (related)
  –î–µ–Ω 2: –î–ù–ö —Ä–µ–ø–∞—Ä–∞—Ü–∏—è ‚Üí –ì–µ–Ω–µ—Ç–∏—á–Ω–∏ –±–æ–ª–µ—Å—Ç–∏ (related)

  –í–ú–ï–°–¢–û:
  –î–µ–Ω 1: –ì–µ–Ω–Ω–∏ –º—É—Ç–∞—Ü–∏–∏ ‚Üí –ü–æ–ø—É–ª–∞—Ü–∏–æ–Ω–Ω–∞ –≥–µ–Ω–µ—Ç–∏–∫–∞ (unrelated)
```

---

### Feature 3: Crunch Mode

#### –ö–æ–≥–∞ —Å–µ –∞–∫—Ç–∏–≤–∏—Ä–∞?

```typescript
const isCrunchMode = (
  workloadPerDay > 5  // –ú–Ω–æ–≥–æ —Ä–∞–±–æ—Ç–∞
  ||
  (daysUntilExam < 7 && workloadPerDay > 3)  // –°–∫–æ—Ä–æ + —É–º–µ—Ä–µ–Ω–æ –Ω–∞—Ç–æ–≤–∞—Ä–µ–Ω
);
```

**Thresholds:**
- `workloadPerDay > 5 units` ‚Üí CRUNCH (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –≤—Ä–µ–º–µ—Ç–æ)
- `daysUntilExam < 7 AND workloadPerDay > 3 units` ‚Üí CRUNCH (—Å–∫–æ—Ä–æ + –Ω–∞—Ç–æ–≤–∞—Ä–µ–Ω)

#### –ö–∞–∫–≤–æ —Å–µ –ø—Ä–æ–º–µ–Ω—è –≤ Crunch Mode?

```typescript
// –ù–û–†–ú–ê–õ–ï–ù —Ä–µ–∂–∏–º:
priority = decayScore + weightedStatus;

// CRUNCH —Ä–µ–∂–∏–º (–∑–∞ –°–ò–í–ò —Ç–µ–º–∏):
priority = decayScore + weightedStatus + sizeBonus;

const sizeBonus = {
  'small': 3,   // –ö—Ä–∞—Ç–∫–∏—Ç–µ –ø–æ–ª—É—á–∞–≤–∞—Ç –≥–æ–ª—è–º –±–æ–Ω—É—Å
  'medium': 1,  // –°—Ä–µ–¥–Ω–∏—Ç–µ - –º–∞–ª—ä–∫ –±–æ–Ω—É—Å
  'large': 0    // –î—ä–ª–≥–∏—Ç–µ - –±–µ–∑ –±–æ–Ω—É—Å
};

// –†–µ–∑—É–ª—Ç–∞—Ç: –ö—Ä–∞—Ç–∫–∏—Ç–µ —Å–∏–≤–∏ —Ç–µ–º–∏ –∏–∑–ø–ª—É–≤–∞—Ç –Ω–∞–≥–æ—Ä–µ –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
```

#### –õ–æ–≥–∏–∫–∞
```
–ü—Ä–∏ —Å–ª—É—á–∞–µ–Ω –∏–∑–ø–∏—Ç + –º–∞–ª–∫–æ –≤—Ä–µ–º–µ:
  ‚Üí –ü–æ-–¥–æ–±—Ä–µ –¥–∞ –ø–æ–∫—Ä–∏–µ—à 10 –∫—Ä–∞—Ç–∫–∏ —Ç–µ–º–∏
  ‚Üí –û—Ç–∫–æ–ª–∫–æ—Ç–æ –¥–∞ –Ω–∞—É—á–∏—à 3 –¥—ä–ª–≥–∏ –ø–µ—Ä—Ñ–µ–∫—Ç–Ω–æ
  ‚Üí –ó–∞—â–æ—Ç–æ —à–∞–Ω—Å—ä—Ç –¥–∞ –∏–∑—Ç–µ–≥–ª–∏—à –ø–æ–∑–Ω–∞—Ç–∞ —Ç–µ–º–∞ –µ –ø–æ-–≥–æ–ª—è–º
```

#### UI Indicators

**Today Page (–ø—Ä–∏ –∞–∫—Ç–∏–≤–µ–Ω Crunch Mode):**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ö° CRUNCH MODE                                       ‚îÇ
‚îÇ    5.2 units/–¥–µ–Ω | –ò–∑–ø–∏—Ç —Å–ª–µ–¥ 4 –¥–Ω–∏                ‚îÇ
‚îÇ    –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –∫—Ä–∞—Ç–∫–∏ –Ω–µ–ø–æ–∫—Ä–∏—Ç–∏ —Ç–µ–º–∏                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                     ‚îÇ
‚îÇ –ü—Ä–µ–ø–æ—Ä—ä—á–∞–Ω–∏ –¥–Ω–µ—Å:                                  ‚îÇ
‚îÇ üü¢ S  –¢–µ–º–∞ X ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ —Å–≤—ä—Ä–∑–∞–Ω–∞ —Å Y   ‚îÇ
‚îÇ üü¢ S  –¢–µ–º–∞ Y ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ —Å–≤—ä—Ä–∑–∞–Ω–∞ —Å X   ‚îÇ
‚îÇ üü° M  –¢–µ–º–∞ Z                                        ‚îÇ
‚îÇ ‚ö™ L  –¢–µ–º–∞ W ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –∞–∫–æ –æ—Å—Ç–∞–Ω–µ –≤—Ä–µ–º–µ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ –°—Ç—Ä–∞—Ç–µ–≥–∏—è: –ú–∏–Ω–∏ –ø—ä—Ä–≤–æ –∫—Ä–∞—Ç–∫–∏—Ç–µ (S), –ø–æ—Å–ª–µ —Å—Ä–µ–¥–Ω–∏—Ç–µ ‚îÇ
‚îÇ                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Size Badges:**
```
üü¢ S = Small (–∫—Ä–∞—Ç–∫–∞)
üü° M = Medium (—Å—Ä–µ–¥–Ω–∞)
üî¥ L = Large (–¥—ä–ª–≥–∞)
```

**AI Advice Integration:**
```
–ü—Ä–∏ crunch mode, AI –ø–æ–ª—É—á–∞–≤–∞:
- isCrunchMode: true
- workloadPerDay: 5.2
- topicsBySize: { small: 15, medium: 20, large: 10 }

AI –º–æ–∂–µ –¥–∞ –∫–∞–∂–µ:
"CRUNCH MODE: –ò–º–∞—à 15 –∫—Ä–∞—Ç–∫–∏ —Ç–µ–º–∏ –Ω–µ–ø–æ–∫—Ä–∏—Ç–∏.
 –ê–∫–æ –º–∏–Ω–µ—à 5 –∫—Ä–∞—Ç–∫–∏ –¥–Ω–µ—Å –≤–º–µ—Å—Ç–æ 2 –¥—ä–ª–≥–∏,
 —à–∞–Ω—Å—ä—Ç –¥–∞ –∏–∑—Ç–µ–≥–ª–∏—à –ø–æ–∑–Ω–∞—Ç–∞ —Ç–µ–º–∞ —Å–µ —É–≤–µ–ª–∏—á–∞–≤–∞ –∑–Ω–∞—á–∏—Ç–µ–ª–Ω–æ."
```

---

### Data Model Summary

```typescript
// Additions to Topic interface in types.ts
interface Topic {
  // ... existing fields (id, name, status, material, etc.)

  // NEW: Size classification
  size: 'small' | 'medium' | 'large' | null;
  sizeSetBy: 'ai' | 'user' | null;

  // NEW: Relations
  relatedTopics: string[];      // IDs of related topics
  cluster: string | null;       // Group name (e.g., "–ü—É–ª–º–æ–ª–æ–≥–∏—è")
  prerequisites: string[];      // IDs of prerequisite topics
}

// Helper type for relation analysis
interface TopicCluster {
  name: string;                 // e.g., "–ü—É–ª–º–æ–ª–æ–≥–∏—è"
  topicIds: string[];
  subjectId: string;
}
```

---

### Algorithm: Smart Daily Schedule

```typescript
function generateSmartDailyPlan(
  subject: Subject,
  daysUntilExam: number,
  workloadPerDay: number,
  dailyCapacity: number  // max topics per day
): Topic[] {

  const isCrunchMode = workloadPerDay > 5 || (daysUntilExam < 7 && workloadPerDay > 3);

  // 1. Get all non-green topics
  let candidates = subject.topics.filter(t => t.status !== 'green');

  // 2. Calculate priority for each
  candidates = candidates.map(topic => ({
    ...topic,
    priority: calculatePriority(topic, isCrunchMode)
  }));

  // 3. Sort by priority (highest first)
  candidates.sort((a, b) => b.priority - a.priority);

  // 4. Select topics for today (respect capacity)
  let selected: Topic[] = [];
  let remainingCapacity = dailyCapacity;

  for (const topic of candidates) {
    if (remainingCapacity <= 0) break;

    // Check if a related topic is already selected
    const hasRelatedSelected = topic.relatedTopics.some(
      relId => selected.find(s => s.id === relId)
    );

    // Boost priority if related topic already selected (keep them together)
    if (hasRelatedSelected) {
      selected.push(topic);
      remainingCapacity--;
      continue;
    }

    selected.push(topic);
    remainingCapacity--;
  }

  // 5. Sort selected by cluster (group related topics)
  selected.sort((a, b) => {
    if (a.cluster === b.cluster) return 0;
    return (a.cluster || '').localeCompare(b.cluster || '');
  });

  return selected;
}

function calculatePriority(topic: Topic, isCrunchMode: boolean): number {
  let priority = 0;

  // Base priority from status (gray = highest need)
  const statusWeight = { gray: 10, orange: 7, yellow: 3, green: 0 };
  priority += statusWeight[topic.status];

  // Decay score (older = higher priority)
  priority += topic.decayScore || 0;

  // Crunch mode: boost small topics
  if (isCrunchMode && topic.status === 'gray') {
    const sizeBonus = { small: 3, medium: 1, large: 0 };
    priority += sizeBonus[topic.size || 'medium'];
  }

  // Prerequisite penalty (if prerequisites not done, lower priority)
  const unmetPrereqs = topic.prerequisites.filter(
    preId => !isTopicComplete(preId)
  ).length;
  priority -= unmetPrereqs * 2;

  return priority;
}
```

---

### Implementation Steps

**Phase 1: Data Model**
1. Add `size`, `sizeSetBy`, `relatedTopics`, `cluster`, `prerequisites` to Topic type
2. Add migration in storage.ts for existing topics (default: null)
3. Update context.tsx with update functions

**Phase 2: Size Classification**
1. Update extract-material API to return size classification
2. Add size badge to Topic Detail page
3. Add manual size override dropdown
4. Update Topic card to show size indicator

**Phase 3: Relations & Clustering**
1. Create "Analyze Relations" API endpoint
2. Add batch analysis button to Subject page
3. Show related topics in Topic Detail
4. Add cluster grouping view option in Subjects

**Phase 4: Crunch Mode Logic**
1. Add `isCrunchMode()` helper in algorithms.ts
2. Update priority calculation to include size bonus
3. Update Today page to show crunch mode indicator
4. Update AI Advice to mention crunch strategy

**Phase 5: Smart Scheduling**
1. Implement `generateSmartDailyPlan()`
2. Group related topics in daily recommendations
3. Show "learn together" hints in UI
4. Add prerequisite warnings

**Phase 6: Polish**
1. Visual indicators for size (S/M/L badges)
2. Cluster visualization in subject overview
3. Crunch mode banner with strategy tips
4. Settings for threshold customization

---

### Edge Cases

1. **No size data** - If topic.size is null, treat as 'medium' for calculations
2. **Circular prerequisites** - Detect and warn, don't block
3. **Orphan topics** - Topics with no relations still get scheduled normally
4. **Manual override** - User size choice always wins over AI
5. **Large cluster** - If cluster has 10+ topics, split across days intelligently

---

### Integration with Session Mode

When Session Mode is active:
- Crunch Mode can still trigger within a session
- Size/relations affect daily topic distribution
- Calendar view shows clusters visually
- Rebalance respects size priorities

---

### Future Enhancements (v2)

- **Learning time tracking** - Actual time per topic to improve size estimates
- **Difficulty rating** - Separate from size (short but hard vs long but easy)
- **Concept graph** - Visual map of topic relationships
- **Smart review** - Spaced repetition using relations (review related topics together)
- **Import from syllabus** - Bulk extract relations from official syllabus PDF

---

*–î–æ–±–∞–≤–µ–Ω–æ: –Ø–Ω—É–∞—Ä–∏ 2025*
*–ó–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è: –°–ª–µ–¥ Session Mode –∏–ª–∏ –ø–∞—Ä–∞–ª–µ–ª–Ω–æ*
